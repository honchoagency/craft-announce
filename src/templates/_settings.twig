{% macro warning(key, file) -%}
    {%- set configArray = craft.app.config.getConfigFromFile(file) -%}
    {%- if configArray[key] is defined -%}
        {{- "This is being overridden by the <span style='font-weight: 600;'>`#{ key }`</span> setting in the <span style='font-weight: 600;'>`config/#{ file }.php`</span> file."|raw }}
    {%- endif -%}
{%- endmacro %}

{% extends '_layouts/cp.twig' %}
{% import '_includes/forms.twig' as forms %}

{% set title = 'Announce' %}
{% set fullPageForm = true %}
{% set configFileName = "announce" %}

{% set tabs = {
    'banner': { label: 'Banner'|t('announce'), url: '#announce-alert' },
    'modal': { label: 'Modal'|t('announce'), url: '#announce-modal' },
} %}

{% set crumbs = [
    { url: 'announce', label: 'Announce' }
] %}

{% block content %}
    {{ actionInput('announce/settings/save-settings') }}

    <div>
        <div id="announce-alert">
            <h2>{{ "Banner"|t('announce') }}</h2>

            <p>{{ "The alert banner will display your announcement at the top of the page for all users."|t('announce') }}</p>

            {{ forms.lightswitchField({
                label: 'Enabled'|t('announce'),
                name: 'bannerEnabled',
                on: config.bannerEnabled ?? settings.bannerEnabled ?? "",
                warning: _self.warning('bannerEnabled', configFileName)
            }) }}

            <hr style="margin-inline: calc(var(--xl)* -1);">

            <h2>{{ "Banner Content"|t('announce') }}</h2>

            <p>{{ "The main announcement message for the alert banner."|t('announce') }}</p>

            {{ forms.textField({
                label: 'Banner Text'|t('announce'),
                name: 'bannerText',
                value: config.bannerText ?? settings.bannerText,
                required: true,
                warning: _self.warning('bannerText', configFileName)
            }) }}

            <hr style="margin-inline: calc(var(--xl)* -1);">

            <h2>{{ "Banner Link"|t('announce') }}</h2>

            <p>{{ "Link the user to more information or any URL."|t('announce') }}</p>

            {{ forms.textField({
                label: 'Banner Link Text'|t('announce'),
                name: 'bannerLinkText',
                value: config.bannerLinkText ?? settings.bannerLinkText,
                instructions: 'Button does not show if blank.'|t('announce'),
                warning: _self.warning('bannerLinkText', configFileName)
            }) }}

            {{ forms.textField({
                label: 'Banner Link URL'|t('announce'),
                name: 'bannerLink',
                value: config.bannerLink ?? settings.bannerLink,
                instructions: 'Opens in new tab. \n Button does not show if blank.'|t('announce'),
                warning: _self.warning('bannerLink', configFileName)
            }) }}
        </div>

        <div id="announce-modal" class="hidden">
            <h2>{{ "Login Modal"|t('announce') }}</h2>

            <p>{{ "The login modal will display your announcement when users log in."|t('announce') }} <a href='/admin/login-announcement' class='go announce-dark-link' target='_blank'>{{ "View Login Modal"|t('announce') }}</a></p>

            {{ forms.lightswitchField({
                label: 'Enabled'|t('announce'),
                name: 'loginModalEnabled',
                on: config.loginModalEnabled ?? settings.loginModalEnabled ?? "",
                instructions: 'Enable for all users.'|t('announce'),
                warning: _self.warning('loginModalEnabled', configFileName),
                toggle: "#login-modal-admins"
            }) }}

            <div id="login-modal-admins">
                {{ forms.lightswitchField({
                    label: 'Enabled for Admins'|t('announce'),
                    name: 'loginModalAdminEnabled',
                    on: config.loginModalAdminEnabled ?? settings.loginModalAdminEnabled ?? "",
                    instructions: 'Enable for admins but only if enabled above.'|t('announce'),
                    warning: _self.warning('loginModalAdminEnabled', configFileName)
                }) }}
            </div>

            <hr style="margin-inline: calc(var(--xl)* -1);">

            <h2>{{ "Modal Content"|t('announce') }}</h2>

            {{ forms.textField({
                label: 'Title'|t('announce'),
                name: 'loginModalTitle',
                value:  config.loginModalTitle ?? settings.loginModalTitle,
                required: true,
                instructions: 'The title of the modal announcement.'|t('announce'),
                warning: _self.warning('loginModalTitle', configFileName)
            }) }}

            {{ forms.textField({
                label: 'Body Text'|t('announce'),
                name: 'loginModalBodyText',
                value: config.loginModalBodyText ?? settings.loginModalBodyText,
                instructions: 'The body text of the modal announcement.'|t('announce'),
                warning: _self.warning('loginModalBodyText', configFileName)
            }) }}

            <hr style="margin-inline: calc(var(--xl)* -1);">

            <h2>{{ "Link Button"|t('announce') }}</h2>

            <p>{{ "Link the user to more information or any URL."|t('announce') }}</p>

            {{ forms.textField({
                label: 'Button Text'|t('announce'),
                name: 'loginModalLinkText',
                value: config.loginModalLinkText ?? settings.loginModalLinkText,
                instructions: 'Button does not show if blank.'|t('announce'),
                warning: _self.warning('loginModalLinkText', configFileName)
            }) }}

            {{ forms.textField({
                label: 'Button URL'|t('announce'),
                name: 'loginModalLink',
                value: config.loginModalLink ?? settings.loginModalLink,
                instructions: 'Opens in new tab. \n Button does not show if blank.'|t('announce'),
                warning: _self.warning('loginModalLink', configFileName)
            }) }}

            <hr style="margin-inline: calc(var(--xl)* -1);">

            <h2>{{ "Continue Button"|t('announce') }}</h2>

            <p>{{ "The user will click this to dismiss the modal announcement and continue to the admin."|t('announce') }}</p>

            {{ forms.textField({
                label: 'Button Text'|t('announce'),
                name: 'loginModalContinueButtonText',
                value: config.loginModalContinueButtonText ?? settings.loginModalContinueButtonText,
                instructions: 'Defaults to "Continue" if empty.'|t('announce'),
                warning: _self.warning('loginModalContinueButtonText', configFileName)
            }) }}

            {{ forms.textField({
                label: 'Button Redirect URL'|t('announce'),
                name: 'loginModalContinueButtonURL',
                value: config.loginModalContinueButtonURL ?? settings.loginModalContinueButtonURL,
                instructions: 'Redirect URL when login modal button is clicked. \n Leave blank to use default behaviour.'|t('announce'),
                warning: _self.warning('loginModalContinueButtonURL', configFileName)
            }) }}
        </div>
    </div>
{% endblock %}
